<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://weenews.github.io</id>
    <title>WeeNews&apos;s blog</title>
    <updated>2020-08-16T08:36:49.840Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://weenews.github.io"/>
    <link rel="self" href="https://weenews.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://weenews.github.io/images/avatar.png</logo>
    <icon>https://weenews.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, WeeNews&apos;s blog</rights>
    <entry>
        <title type="html"><![CDATA[Linuxè¿›ç¨‹ã€çº¿ç¨‹åŠè°ƒåº¦ç®—æ³•]]></title>
        <id>https://weenews.github.io/post/linux-jin-cheng-xian-cheng-ji-diao-du-suan-fa/</id>
        <link href="https://weenews.github.io/post/linux-jin-cheng-xian-cheng-ji-diao-du-suan-fa/">
        </link>
        <updated>2020-08-16T08:35:34.000Z</updated>
        <content type="html"><![CDATA[<h1 id="è¿›ç¨‹ä¸çº¿ç¨‹">è¿›ç¨‹ä¸çº¿ç¨‹</h1>
<p>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯è°ƒåº¦çš„æœ€å°å•ä½</p>
<h2 id="è¿›ç¨‹æ§åˆ¶å—pcb">è¿›ç¨‹æ§åˆ¶å—PCB</h2>
<p>æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å„è‡ªçš„PCBï¼ˆåœ¨Linuxä¸‹å³ä¸ºtask_structï¼‰ï¼Œ<strong>å…¶æè¿°äº†è¿›ç¨‹çš„èµ„æº</strong></p>
<figure data-type="image" tabindex="1"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200809213716021.png" alt="image-20200809213716021" loading="lazy"></figure>
<blockquote>
<p>1.è¯»Linuxå†…æ ¸ä»¥åŠç›¸å…³çš„èµ„æ–™çš„æ—¶å€™ï¼Œæ—¶åˆ»è¦æ¸…é†’åœ°è®¤è¯†åˆ°å®ƒè¯´çš„æ˜¯å†…æ ¸æ€è¿˜æ˜¯ç”¨æˆ·æ€çš„ä¸œè¥¿ã€‚</p>
<p>2.ä¸€ä¸ªç”¨æˆ·æ€è¿›ç¨‹/çº¿ç¨‹åœ¨å†…æ ¸ä¸­éƒ½æ˜¯ç”¨ä¸€ä¸ªtask_structçš„å®ä¾‹æè¿°çš„ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼è®¾è®¡æ¨¡å¼é‡Œé¢çš„æ¡¥æ¥æ¨¡å¼(handle-body), ç”¨æˆ·æ€çœ‹åˆ°çš„è¿›ç¨‹PIDï¼Œçº¿ç¨‹TIDéƒ½æ˜¯handle, task_structæ˜¯bodyã€‚</p>
<p>3.Cè¯­è¨€ä¹¦é‡Œé¢è®²çš„å †ã€æ ˆå¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨æˆ·æ€çš„æ¦‚å¿µï¼Œç”¨æˆ·æ€çš„å †ã€æ ˆå¯¹åº”ç”¨æˆ·è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´é‡Œçš„ä¸€ä¸ªåŒºåŸŸï¼Œæ ˆå‘ä¸‹å¢é•¿ï¼Œå †ç”¨mallocåˆ†é…ï¼Œå‘ä¸Šå¢é•¿ã€‚</p>
<p>3.ç”¨æˆ·ç©ºé—´çš„å †æ ˆï¼Œåœ¨task_struct-&gt;mm-&gt;vm_areaé‡Œé¢æè¿°ï¼Œéƒ½æ˜¯å±äºè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€ä¸ªåŒºåŸŸã€‚</p>
<p>5.è€Œå†…æ ¸æ€çš„æ ˆåœ¨tsak_struct-&gt;stacké‡Œé¢æè¿°ï¼Œå…¶åº•éƒ¨æ˜¯thread_infoå¯¹è±¡ï¼Œthread_infoå¯ä»¥ç”¨æ¥å¿«é€Ÿè·å–task_structå¯¹è±¡ã€‚æ•´ä¸ªstackåŒºåŸŸä¸€èˆ¬åªæœ‰ä¸€ä¸ªå†…å­˜é¡µ(å¯é…ç½®)ï¼Œ32ä½æœºå™¨ä¹Ÿå°±æ˜¯4KBã€‚</p>
<p>6.æ‰€ä»¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å†…æ ¸æ ˆï¼Œä¹Ÿæ˜¯è¿›ç¨‹ç§æœ‰çš„ï¼Œåªæ˜¯åœ¨task_struct-&gt;stacké‡Œé¢è·å–ã€‚</p>
<p>7.å†…æ ¸æ€æ²¡æœ‰è¿›ç¨‹å †çš„æ¦‚å¿µï¼Œç”¨kmalloc()åˆ†é…å†…å­˜ï¼Œå®é™…ä¸Šæ˜¯Linuxå†…æ ¸ç»Ÿä¸€ç®¡ç†çš„ï¼Œä¸€èˆ¬ç”¨slabåˆ†é…å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå†…å­˜ç¼“å­˜æ± ï¼Œç®¡ç†æ‰€æœ‰å¯ä»¥kmalloc()åˆ†é…çš„å†…å­˜ã€‚æ‰€ä»¥ä»åŸç†ä¸Šçœ‹ï¼Œåœ¨Linuxå†…æ ¸æ€ï¼Œkmallocåˆ†é…çš„æ‰€æœ‰çš„å†…å­˜ï¼Œéƒ½æ˜¯å¯ä»¥è¢«æ‰€æœ‰è¿è¡Œåœ¨Linuxå†…æ ¸æ€çš„taskè®¿é—®åˆ°çš„ã€‚</p>
<p>å†…æ ¸åœ¨åˆ›å»ºè¿›ç¨‹æ—¶ï¼Œä¼šåŒæ—¶åˆ›å»ºtask_structå’Œè¿›ç¨‹ç›¸åº”å †æ ˆã€‚æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šæœ‰ä¸¤ä¸ªå †æ ˆï¼Œä¸€ä¸ªç”¨æˆ·æ ˆï¼Œå­˜åœ¨äºç”¨æˆ·ç©ºé—´ï¼Œä¸€ä¸ªå†…æ ¸æ ˆï¼Œå­˜åœ¨äºå†…æ ¸ç©ºé—´ã€‚å½“è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶ï¼ŒCPUå †æ ˆå¯„å­˜å™¨çš„å†…å®¹æ˜¯ç”¨æˆ·å †æ ˆåœ°å€ï¼Œä½¿ç”¨ç”¨æˆ·æ ˆã€‚å½“è¿›ç¨‹åœ¨å†…æ ¸ç©ºé—´æ—¶ï¼ŒCPUå †æ ˆå¯„å­˜å™¨çš„å†…å®¹æ˜¯å†…æ ¸æ ˆåœ°å€ç©ºé—´ï¼Œä½¿ç”¨çš„æ˜¯å†…æ ¸æ ˆã€‚</p>
<p>å½“è¿›ç¨‹å› ä¸ºä¸­æ–­æˆ–ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ—¶ï¼Œè¿›ç¨‹ä½¿ç”¨çš„å †æ ˆä¹Ÿéœ€è¦ä»ç”¨æˆ·æ ˆåˆ°å†…æ ¸æ ˆã€‚è¿›ç¨‹é™·å…¥å†…æ ¸æ€åï¼Œå…ˆæŠŠç”¨æˆ·å †æ ˆçš„åœ°å€ä¿å­˜åˆ°å†…æ ¸å †æ ˆä¸­ï¼Œç„¶åè®¾ç½®CPUå †æ ˆå¯„å­˜å™¨ä¸ºå†…æ ¸æ ˆçš„åœ°å€ï¼Œè¿™æ ·å°±å®Œæˆäº†ç”¨æˆ·æ ˆåˆ°å†…æ ¸æ ˆçš„è½¬æ¢ã€‚</p>
<p>å½“è¿›ç¨‹ä»å†…æ ¸æ€æ¢å¤åˆ°ç”¨æˆ·æ€æ—¶ï¼ŒæŠŠå†…æ ¸ä¸­ä¿å­˜çš„ç”¨æˆ·æ€å †æ ˆçš„åœ°å€æ¢å¤åˆ°å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨å³å¯ã€‚è¿™æ ·å°±å®ç°äº†å†…æ ¸æ ˆåˆ°ç”¨æˆ·æ ˆçš„è½¬æ¢ã€‚</p>
<p>æ³¨æ„ï¼šé™·å…¥å†…æ ¸æ ˆæ—¶ï¼Œå¦‚ä½•çŸ¥é“å†…æ ¸æ ˆçš„åœ°å€å‘¢ï¼Ÿ<br>
è¿›ç¨‹ç”±ç”¨æˆ·æ ˆåˆ°å†…æ ¸æ ˆè½¬æ¢æ—¶ï¼Œè¿›ç¨‹çš„å†…æ ¸æ ˆæ€»æ˜¯ç©ºçš„ã€‚æ¯æ¬¡ä»ç”¨æˆ·æ€é™·å…¥å†…æ ¸æ—¶ï¼Œå¾—åˆ°çš„å†…æ ¸æ ˆéƒ½æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åœ¨è¿›ç¨‹é™·å…¥å†…æ ¸æ—¶ï¼Œç›´æ¥æŠŠå†…æ ¸æ ˆé¡¶åœ°å€ç»™å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨å³å¯ã€‚ï¼ˆå†…æ ¸æ ˆåœ°å€æ˜¯å›ºå®šçš„ï¼‰</p>
<h4 id="å†…æ ¸æ ˆçš„ä½œç”¨">å†…æ ¸æ ˆçš„ä½œç”¨</h4>
<p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼šåœ¨é™·å…¥å†…æ ¸åï¼Œç³»ç»Ÿè°ƒç”¨ä¸­ä¹Ÿæ˜¯å­˜åœ¨å‡½æ•°è°ƒç”¨å’Œè‡ªåŠ¨å˜é‡ï¼Œè¿™äº›éƒ½éœ€è¦æ ˆæ”¯æŒã€‚ç”¨æˆ·ç©ºé—´çš„æ ˆ<strong>æ˜¾ç„¶ä¸å®‰å…¨</strong>ï¼Œéœ€è¦å†…æ ¸æ ˆçš„æ”¯æŒã€‚æ­¤å¤–ï¼Œå†…æ ¸æ ˆåŒæ—¶ç”¨äºä¿å­˜ä¸€äº›ç³»ç»Ÿè°ƒç”¨å‰(ç”¨æˆ·æ€ï¼‰çš„ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·ç©ºé—´æ ˆæŒ‡é’ˆã€ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼‰ã€‚</p>
</blockquote>
<h3 id="task_structçš„ç®¡ç†">task_structçš„ç®¡ç†</h3>
<p>å½¢æˆé“¾è¡¨ã€æ ‘ã€å“ˆå¸Œï¼ˆpid -&gt; task_structï¼‰ä»¥åœ¨é€‚åº”ä¸åŒåœºæ™¯ï¼Œç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</p>
<h2 id="è¿›ç¨‹çŠ¶æ€">è¿›ç¨‹çŠ¶æ€</h2>
<figure data-type="image" tabindex="2"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200809231549854.png" alt="image-20200809231549854" loading="lazy"></figure>
<p><strong>å†…å­˜æ³„æ¼</strong>ï¼šè¿›ç¨‹å¦‚æœæ²¡æœ‰é‡Šæ”¾èµ„æºå°±æŒ‚äº†ï¼Œé‚£ä¸å«å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¿›ç¨‹æŒ‚äº†ï¼Œå®ƒçš„å†…å­˜èµ„æºä¹Ÿä¼šè¢«è‡ªåŠ¨å›æ”¶ï¼Œ</p>
<p>å†…å­˜æ³„æ¼æ˜¯æŒ‡è¿›ç¨‹æ´»ç€ï¼Œä¸”éšç€æ—¶é—´å®ƒä½¿ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼ˆç”±äºæŸç§åŸå› ä¸æ–­çš„åˆ†é…ç©ºé—´è€Œæ²¡æœ‰é‡Šæ”¾ï¼‰</p>
<blockquote>
<p>è¯Šæ–­ï¼šæŒç»­è§‚å¯Ÿè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœè¶Šæ¥è¶Šå¤šåˆ™è¯´æ˜ç”±å†…å­˜æ³„æ¼</p>
</blockquote>
<p><strong>cpulimit åŸç†</strong>ï¼šä¸æ–­çš„åœæ­¢å’Œæ¢å¤è¿›ç¨‹çš„æ‰§è¡Œ</p>
<pre><code class="language-bash">cpulimit -l 10 -p 12296
</code></pre>
<h2 id="forkåŸç†">forkåŸç†</h2>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå°±æ˜¯ä½¿ç”¨fork()ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥è¦å…³æ³¨fork</p>
<figure data-type="image" tabindex="3"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200809224618314.png" alt="image-20200809224618314" loading="lazy"></figure>
<h3 id="fork-vfork-pthread_create">forkã€vforkã€pthread_create</h3>
<img src="C:\Users\xwq\AppData\Roaming\Typora\typora-user-images\image-20200810211002993.png" alt="image-20200810211002993" style="zoom:100%;" />
<p>forkã€vforkã€pthread_createçš„åº•å±‚éƒ½æ˜¯ä½¿ç”¨äº†cloneï¼Œåªä¸è¿‡cloneçš„èµ„æºä¸åŒï¼ˆå®ç°ä¸Šæ˜¯æŒ‡task_structä¸­çš„å„æˆå‘˜ï¼‰</p>
<p><strong>ç¨‹åºçš„æ‰§è¡Œ</strong>ï¼šåŠ è½½æ—¶åªæ˜¯åšäº†ä¸€ä¸ªè™šæ‹Ÿç©ºé—´å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹é—´çš„æ˜ å°„ï¼Œå¹¶æ²¡æœ‰å®é™…åˆ†é…ç‰©ç†å†…å­˜ï¼Œæ›´æ²¡æœ‰ä»ç£ç›˜è¯»å–æ–‡ä»¶å†…å®¹åˆ°å†…å­˜ã€‚ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œå †ï¼Œæ ˆç­‰è¿™æ—¶å€™éƒ½åªæ˜¯å­˜åœ¨äºè™šæ‹Ÿç©ºé—´ã€‚ç¨‹åºå¼€å§‹æ‰§è¡Œåï¼Œå…ˆè®¿é—®è™šæ‹Ÿç©ºé—´çš„ä»£ç æ®µï¼Œæ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰é€šè¿‡TLBå’ŒPage TableæŸ¥æ‰¾è™šæ‹Ÿé¡µé¢ï¼ˆPageï¼‰æ‰€å¯¹åº”çš„ç‰©ç†å†…å­˜é¡µæ¡†ï¼ˆPage Frameï¼‰æ—¶ï¼Œå‘ç°è¿˜æ²¡æœ‰å¯¹åº”çš„ç‰©ç†é¡µæ¡†ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†ç¼ºé¡µä¸­æ–­ï¼ˆPage Faultï¼‰ï¼Œè¿™æ—¶å€™æ“ä½œç³»ç»Ÿæ‰ä¼šåˆ†é…ç‰©ç†å†…å­˜ï¼Œå¹¶å°†ç¨‹åºçš„å¯æ‰§è¡Œæ–‡ä»¶è¯»å…¥å†…å­˜ä¸­ï¼Œå¼€å§‹æ‰§è¡Œç¨‹åºä»£ç ã€‚å †æ ˆä¸­çš„å†…å­˜ä¹Ÿæ˜¯åœ¨éœ€è¦è®¿é—®çš„æ—¶å€™ï¼Œå‘ç”ŸPage Faultï¼Œç„¶åæ‰åˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
<blockquote>
<p>CLONE_PARENT  åˆ›å»ºçš„å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯è°ƒç”¨è€…çš„çˆ¶è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹ä¸åˆ›å»ºå®ƒçš„è¿›ç¨‹æˆäº†â€œå…„å¼Ÿâ€è€Œä¸æ˜¯â€œçˆ¶å­â€</p>
<p>CLONE_FS      å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬rootã€å½“å‰ç›®å½•ã€umask</p>
<p>CLONE_FILES   å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰è¡¨</p>
<p>CLONE_NEWNS  åœ¨æ–°çš„namespaceå¯åŠ¨å­è¿›ç¨‹ï¼Œnamespaceæè¿°äº†è¿›ç¨‹çš„æ–‡ä»¶hierarchy</p>
<p>CLONE_SIGHAND  å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„ä¿¡å·å¤„ç†ï¼ˆsignal handlerï¼‰è¡¨</p>
<p>CLONE_PTRACE  è‹¥çˆ¶è¿›ç¨‹è¢«traceï¼Œå­è¿›ç¨‹ä¹Ÿè¢«trace</p>
<p>CLONE_VFORK   çˆ¶è¿›ç¨‹è¢«æŒ‚èµ·ï¼Œç›´è‡³å­è¿›ç¨‹é‡Šæ”¾è™šæ‹Ÿå†…å­˜èµ„æº</p>
<p>CLONE_VM      å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹è¿è¡Œäºç›¸åŒçš„å†…å­˜ç©ºé—´</p>
<p>CLONE_PID     å­è¿›ç¨‹åœ¨åˆ›å»ºæ—¶PIDä¸çˆ¶è¿›ç¨‹ä¸€è‡´</p>
<p>CLONE_THREAD  Linux 2.4ä¸­å¢åŠ ä»¥æ”¯æŒPOSIXçº¿ç¨‹æ ‡å‡†ï¼Œå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„çº¿ç¨‹ç¾¤</p>
</blockquote>
<h3 id="fork-vs-vfork">fork  vs  vfork</h3>
<p>åœ¨Linuxä¸­ï¼Œä¸¤è€…çš„åŒºåˆ«å®é™…ä¸Šå·²ç»å¾ˆå°äº†ï¼Œfork()å…¶å®å·²ç»è¶³å¤Ÿæ¥æ›¿ä»£vfork()äº†ã€‚vfork()ç›¸å¯¹äºfork()æ˜¯ä¸éœ€è¦æ‹·è´page table entriesï¼Œå°±æ˜¯è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚fork()çš„å†™æ—¶æ‹·è´æŒ‡çš„æ˜¯å…·ä½“çš„å†…å­˜æ•°æ®è¢«æ”¹æ—¶æ‹·è´ï¼Œè€Œè™šæ‹Ÿå†…å­˜ç©ºé—´å¸ƒå±€è¿˜æ˜¯å¿…é¡»è¦æ‹·è´çš„ã€‚è€Œä¸”vfork()ä¹Ÿæ²¡æœ‰å†™æ—¶æ‹·è´çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥vfork()å®é™…è¿˜æ˜¯æ¯”fork()å¼€é”€å°ã€‚ä½†æ˜¯vfork()çš„å­è¿›ç¨‹é‡Œä¸èƒ½è®¿é—®/ä¿®æ”¹åŸæ¥çš„æ•°æ®ï¼Œè¿™æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚ä¸€èˆ¬é‡‡ç”¨vfork()çš„å­è¿›ç¨‹ï¼Œéƒ½ä¼šç´§æ¥ç€æ‰§è¡Œexecvå¯åŠ¨ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´ä¸çˆ¶è¿›ç¨‹å®Œå…¨ç‹¬ç«‹ä¸ç›¸å¹²ï¼Œæ‰€ä»¥ä¸éœ€è¦å¤åˆ¶çˆ¶è¿›ç¨‹èµ„æºç©ºé—´ã€‚</p>
<h3 id="pidä¸tgid">PIDä¸TGID</h3>
<figure data-type="image" tabindex="4"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810205349657.png" alt="image-20200810205349657" loading="lazy"></figure>
<p>Linuxä¸­ï¼Œä½¿ç”¨getpid()æˆ–è€…topå‘½ä»¤å¾—åˆ°çš„æ˜¯TGIDï¼Œå®ƒä»£è¡¨è¿›ç¨‹IDï¼ˆçˆ¶çº¿ç¨‹çš„pidï¼‰ï¼ŒçœŸæ­£task_structä¸­çš„pidå¯ä»¥ä½¿ç”¨gettid()æˆ–top -Hå¾—åˆ°ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªçº¿ç¨‹çš„pidã€‚ä½¿ç”¨top -H åªèƒ½çœ‹åˆ°å­çº¿ç¨‹çš„pidï¼Œçœ‹ä¸åˆ°çˆ¶çº¿ç¨‹çš„pidã€‚</p>
<figure data-type="image" tabindex="5"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810214324956.png" alt="image-20200810214324956" loading="lazy"></figure>
<h2 id="subreaperä¸æ‰˜å­¤">subreaperä¸æ‰˜å­¤</h2>
<p>PR_SET_CHILD_SUBREAPERæ˜¯linux3.4åŠ å…¥çš„æ–°ç‰¹æ€§ã€‚æŠŠå®ƒè®¾ç½®ä¸ºéé›¶å€¼ï¼Œå½“å‰è¿›ç¨‹å°±ä¼šå˜æˆsubreaperï¼Œå°±ä¼šåƒ1å·è¿›ç¨‹é‚£æ ·æ”¶å…»å­¤å„¿è¿›ç¨‹äº†ã€‚</p>
<figure data-type="image" tabindex="6"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810211931943.png" alt="image-20200810211931943" loading="lazy"></figure>
<p>çˆ¶è¿›ç¨‹æŒ‚æ‰ï¼Œå­è¿›ç¨‹å˜ä¸ºå­¤å„¿è¿›ç¨‹ï¼Œå…¶ä¼šè¢«subreaperæ”¶å…»ï¼Œå‘ä¸Šæ‰¾ï¼Œæ‰¾subreaperï¼Œç›´åˆ°init</p>
<figure data-type="image" tabindex="7"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810212257382.png" alt="image-20200810212257382" loading="lazy"></figure>
<p><strong>ä½¿ç”¨pstreeçœ‹åˆ°çš„ä¸­é—´çš„initå°±æ˜¯subreaper</strong></p>
<h1 id="è¿›ç¨‹è°ƒåº¦">è¿›ç¨‹è°ƒåº¦</h1>
<p>åå vs å“åº”</p>
<p>ååå’Œå“åº”ä¹‹é—´çš„çŸ›ç›¾ï¼š</p>
<ul>
<li>å“åº”ï¼šæœ€å°åŒ–æŸä»»åŠ¡çš„å“åº”æ—¶é—´ï¼Œå“ªæ€•ä»¥ç‰ºç‰²å…¶ä»–çš„ä»»åŠ¡ä¸ºä»£ä»·</li>
<li>ååï¼šå…¨å±€è§†é‡ï¼Œæ•´ä¸ªç³»ç»Ÿçš„workloadè¢«æœ€å¤§åŒ–å¤„ç†</li>
</ul>
<p>IOæ¶ˆè€—å‹ vs CPUæ¶ˆè€—å‹</p>
<ul>
<li>IOæ¶ˆè€—å‹ï¼šCPUåˆ©ç”¨ç‡ä½ï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰å¾…IOï¼Œå®ƒå¯¹CPUçš„æ¶ˆè€—è¾ƒå°‘ï¼Œæ›´é‡è¦çš„æ˜¯è¦åŠæ—¶å“åº”ï¼Œè¿™æ ·ç±»å‹çš„ä»»åŠ¡å¯ä»¥ç»™å°†å®ƒçš„æ—¶é—´ç‰‡åŒ–å°ä¸€äº›è€Œæé«˜å®ƒçš„è°ƒåº¦é¢‘ç‡</li>
<li>CPUæ¶ˆè€—å‹ï¼šè¿™æ ·çš„ä»»åŠ¡éœ€è¦è¾ƒå¤šçš„CPUèµ„æºï¼Œå¯ä»¥ç»™å…¶åˆ’åˆ†è¾ƒå¤§çš„æ—¶é—´ç‰‡ï¼Œè€Œé™ä½å®ƒçš„è°ƒåº¦é¢‘ç‡</li>
</ul>
<h2 id="o1-è°ƒåº¦">O(1) è°ƒåº¦</h2>
<p>å…ˆçœ‹å›¾ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://picb.zhimg.com/80/v2-729fb18fa3ac1e41beff0fcd817c92a6_720w.jpg" alt="img" loading="lazy"></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä¼°è®¡æœ‰éƒ¨åˆ†è¯»è€…å·²ç»é¢†ä¼šåˆ°å…¶ä¸­çš„å¥¥ä¹‰ã€‚2.6 kernel é‡Œæœ‰ 140 ç§ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨é•¿åº¦ä¸º 140 çš„ array å»è®°å½•ä¼˜å…ˆçº§ã€‚æ¯ä¸ªä¼˜å…ˆçº§ä¸‹é¢ç”¨ä¸€ä¸ª FIFO queue ç®¡ç†è¿™ä¸ªä¼˜å…ˆçº§ä¸‹çš„ processã€‚æ–°æ¥çš„æ’åˆ°é˜Ÿå°¾ï¼Œå…ˆè¿›å…ˆå‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œinsert / deletion éƒ½æ˜¯ O(1)ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰¾åˆ°å½“å‰æœ€é«˜ä¼˜å…ˆçº§ä¸‹é¢çš„å¯æ‰§è¡Œçš„ process å‘¢ï¼Ÿå¦‚æœä» 0 å¼€å§‹ä¸€ç›´éå†ä¸‹å»ï¼Œç®—æ³•è™½ç„¶ä¸æ˜¯ O(N)ï¼Œä½†æ˜¯æ˜¯è·Ÿä¼˜å…ˆçº§å¤šå¯¡ç›¸å…³çš„ O(M)ï¼Œä¹Ÿä¸èƒ½ç®—ä½œ O(1)ã€‚åœ¨ 2.6 scheduler é‡Œï¼Œèªæ˜çš„å…ˆè´¤ä»¬é‡‡ç”¨ bitarrayã€‚å®ƒä¸ºæ¯ç§ä¼˜å…ˆçº§åˆ†é…ä¸€ä¸ª bitï¼Œå¦‚æœè¿™ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ä¸‹é¢æœ‰ processï¼Œé‚£ä¹ˆå°±å¯¹ç›¸åº”çš„ bit æŸ“è‰²ï¼Œç½®ä¸º 1ï¼Œå¦åˆ™ç½®ä¸º 0ã€‚è¿™æ ·ï¼Œé—®é¢˜å°±ç®€åŒ–æˆå¯»æ‰¾ä¸€ä¸ª bitarray é‡Œé¢æœ€é«˜ä½æ˜¯ 1 çš„ bitï¼ˆleft-most bitï¼‰ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ä¸€æ¡ CPU æŒ‡ä»¤çš„äº‹ï¼ˆflsï¼‰ã€‚</p>
<p>å¥½ï¼Œå¤§è‡´çš„æ€è·¯é½å¤‡ï¼Œæˆ‘ä»¬æ¥æ‹ä¸€æ‹å®Œæ•´çš„æ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨ active bitarray é‡Œï¼Œå¯»æ‰¾ left-most bit çš„ä½ç½® xã€‚</li>
<li>åœ¨ active priority arrayï¼ˆAPAï¼‰ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”é˜Ÿåˆ— APA[x]ã€‚</li>
<li>ä» APA[x] ä¸­ dequeue ä¸€ä¸ª processï¼Œdequeue åï¼Œå¦‚æœ APA[x] çš„ queue ä¸ºç©ºï¼Œé‚£ä¹ˆå°† active bitarray é‡Œç¬¬ x bitç½®ä¸º 0ã€‚</li>
<li>å¯¹äºå½“å‰æ‰§è¡Œå®Œçš„ processï¼Œé‡æ–°è®¡ç®—å…¶ priorityï¼Œç„¶å enqueue åˆ° expired priority arrayï¼ˆEPAï¼‰ç›¸åº”çš„é˜Ÿé‡Œ EPA[priority]ã€‚</li>
<li>å¦‚æœ priority åœ¨ expired bitarray é‡Œå¯¹åº”çš„ bit ä¸º 0ï¼Œå°†å…¶ç½® 1ã€‚</li>
<li>å¦‚æœ active bitarray å…¨ä¸ºé›¶ï¼Œå°† active bitarray å’Œ expired bitarray äº¤æ¢ä¸€ä¸‹ã€‚</li>
</ol>
<p>å½“ç„¶ï¼Œè¿™é‡Œé¢è¿˜æœ‰ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚å¦‚æœæ˜¯ process è¢«æŠ¢å ï¼Œå…¶æ—¶é—´ç‰‡æ²¡ç”¨å®Œï¼Œé‚£ä¹ˆç¬¬ 4 æ­¥ï¼Œenqueue å› active priority queue ä¸­ã€‚ä¸è¿‡è¿™å’Œç®—æ³•æœ¬èº«æ²¡å¤ªå¤§å…³ç³»ï¼Œæˆ‘ä»¬ç•¥è¿‡ä¸è¡¨ã€‚</p>
<p><strong>å†å²åœ°ä½</strong></p>
<p>2.6 O(1) scheduler ç›®å‰å·²ç»è¢«æ€§èƒ½ç•¥è¾“ä¸€ç­¹ï¼ŒåŒæ—¶æ›´åŠ å¼ºè°ƒå…¬å¹³æ€§çš„ CFSï¼ˆCompletely Fair Schedulerï¼‰å–ä»£ï¼Œä½†å…¶ä»¥ç‹¬ç‰¹çš„è®¾è®¡ï¼Œç®€å•çš„ç®—æ³•ï¼Œå½±å“å¾ˆå¤šç³»ç»Ÿã€‚åœ¨å…¶åˆšé—®ä¸–æ—¶ï¼Œå¾ˆå¤š linux å‘è¡Œç‰ˆå°±è¿«ä¸åŠå¾…å°†å…¶ç§»æ¤å› 2.4 kernelã€‚è€Œç¨‹åºå›æ•´ä¸ªèŒä¸šç”Ÿæ¶¯ä¸­æ¥è§¦è¿‡çš„ä¸€äº›è°ƒåº¦å™¨ä¸­ï¼Œéƒ½èƒ½è§åˆ° bitarray + priority queue çš„èº«å½±ã€‚</p>
<figure data-type="image" tabindex="9"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200813010717364.png" alt="image-20200813010717364" loading="lazy"></figure>
<h2 id="æ—©æœŸ26å®æ—¶è¿›ç¨‹è°ƒåº¦">æ—©æœŸ2.6å®æ—¶è¿›ç¨‹è°ƒåº¦</h2>
<ul>
<li>SCHED_FIFOï¼šä¸åŒä¼˜å…ˆçº§æŒ‰ç…§ä¼˜å…ˆçº§é«˜çš„å…ˆè·‘åˆ°ç¡çœ ï¼Œä½ä¼˜å…ˆçº§çš„å†è·‘ï¼›åŒç­‰ä¼˜å…ˆçº§å…ˆè¿›å…ˆå‡º</li>
<li>SCHED_RRï¼šä¸åŒä¼˜å…ˆçº§æŒ‰ç…§ä¼˜å…ˆçº§é«˜çš„å…ˆè·‘åˆ°ç¡çœ ï¼Œä½ä¼˜å…ˆçº§çš„å†è·‘ï¼›åŒç­‰ä¼˜å…ˆçº§è½®è½¬</li>
</ul>
<h2 id="æ—©æœŸ26éå®æ—¶è¿›ç¨‹æ™®é€šè¿›ç¨‹çš„è°ƒåº¦å’ŒåŠ¨æ€ä¼˜å…ˆçº§">æ—©æœŸ2.6éå®æ—¶è¿›ç¨‹ï¼ˆæ™®é€šè¿›ç¨‹ï¼‰çš„è°ƒåº¦å’ŒåŠ¨æ€ä¼˜å…ˆçº§</h2>
<p>SCHED_NORMAL</p>
<ul>
<li>è°ƒåº¦åœ¨ä¸åŒè¿›ç¨‹é—´è½®è½¬</li>
<li>-20 ~ 19çš„niceå€¼</li>
<li>æ ¹æ®ç¡çœ æƒ…å†µï¼ŒåŠ¨æ€å¥–åŠ±ä¸æƒ©ç½šï¼ˆç¡çœ ä¼šè¢«å¥–åŠ±ï¼Œæé«˜å¾—åˆ°cpuçš„æ¦‚ç‡ï¼Œè¿è¡Œä¼šè¢«æƒ©ç½šï¼‰<strong>è¿™æ ·IOæ¶ˆè€—å‹å°±å¯ä»¥æŠ¢çš„è¿‡CPUæ¶ˆè€—å‹äº†</strong></li>
</ul>
<p>ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹å¯ä»¥å¾—åˆ°æ›´é•¿çš„æ—¶é—´ç‰‡å¹¶ä¸”å¯ä»¥åœ¨é†’æ¥æ—¶æŠ¢å ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œä¹‹åå†å’Œå®ƒä»¬ä¸€èµ·è½®è½¬</p>
<p>**rté™åˆ¶ï¼š**å®æ—¶è¿›ç¨‹éƒ½ç¡çœ äº†ï¼Œéå®æ—¶çš„æ‰å¯ä»¥è·‘ï¼Œåæ¥linuxæ‰“äº†è¡¥ä¸ï¼Œå®æ—¶è¿›ç¨‹åœ¨ä¸€ä¸ªå‘¨æœŸå†…æœ€å¤šå ç”¨cpuçš„æ¯”ä¾‹ä¸º95%ï¼ˆå¯è®¾ç½®ï¼‰</p>
<figure data-type="image" tabindex="10"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810224805315.png" alt="image-20200810224805315" loading="lazy"></figure>
<h2 id="ç°æœ‰æ™®é€šè¿›ç¨‹çš„è°ƒåº¦cfså®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•">ç°æœ‰æ™®é€šè¿›ç¨‹çš„è°ƒåº¦CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦ç®—æ³•ï¼‰</h2>
<figure data-type="image" tabindex="11"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810233315094.png" alt="image-20200810233315094" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200810233333970.png" alt="image-20200810233333970" loading="lazy"></figure>
<pre><code>niceå€¼æˆ–è€…è¯´è°ƒåº¦ä¸cpuå ç”¨ç‡æ²¡æœ‰ç»å¯¹çš„å…³ç³»ï¼šè°ƒåº¦åªæ˜¯è§£å†³åœ¨å¤§å®¶éƒ½è¦ä½¿ç”¨cpuæ—¶ï¼Œå°†æ‰§è¡Œæœºä¼šç»™è°çš„é—®é¢˜ï¼›cpuå ç”¨ç‡ä¸»è¦ç”±è¿›ç¨‹æ‰€æ‰§è¡Œçš„ä»»åŠ¡å†³å®š
</code></pre>
<blockquote>
<p>å·¥å…·chrtå’Œreniceï¼š</p>
<p>è®¾ç½®SCHED_FIFOå’Œ50 RT ä¼˜å…ˆçº§ï¼šchrt -f -a -p 50  pid</p>
<p>è®¾ç½®niceï¼šrenice -n -5 -g pid             nice  -n   5   ./a.out</p>
</blockquote>
<h1 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h1>
<figure data-type="image" tabindex="13"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811005816300.png" alt="image-20200811005816300" loading="lazy"></figure>
<p>è®¾ç½®è¿›ç¨‹åœ¨é‚£ä¸ªæ ¸ä¸Šè¿è¡Œï¼š</p>
<ul>
<li><strong>è®¾ç½®affinity</strong></li>
</ul>
<figure data-type="image" tabindex="14"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811000609363.png" alt="image-20200811000609363" loading="lazy"></figure>
<ul>
<li><strong>taskset</strong></li>
</ul>
<figure data-type="image" tabindex="15"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811000751953.png" alt="image-20200811000751953" loading="lazy"></figure>
<figure data-type="image" tabindex="16"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811005916918.png" alt="image-20200811005916918" loading="lazy"></figure>
<figure data-type="image" tabindex="17"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811010116599.png" alt="image-20200811010116599" loading="lazy"></figure>
<figure data-type="image" tabindex="18"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811005957531.png" alt="image-20200811005957531" loading="lazy"></figure>
<figure data-type="image" tabindex="19"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811010017183.png" alt="image-20200811010017183" loading="lazy"></figure>
<figure data-type="image" tabindex="20"><img src="C:%5CUsers%5Cxwq%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200811010253163.png" alt="image-20200811010253163" loading="lazy"></figure>
<p>ä¸å¯æŠ¢å çš„æ—¶æœºï¼šä¸­æ–­ã€è½¯ä¸­æ–­ã€è¿›ç¨‹ä¸Šä¸‹æ–‡çš„spin_lockï¼Œå…¶ä»–éƒ½å¯ä»¥æŠ¢å </p>
<p>PREEMPT_RTè¡¥ä¸ï¼š</p>
<ul>
<li>spin_lockè¿ç§»ä¸ºå¯è°ƒåº¦çš„mutexï¼ŒåŒæ—¶æŠ¥äº†raw_spinlock_t</li>
<li>å®ç°ä¼˜å…ˆçº§ç»§æ‰¿åè®®</li>
<li>ä¸­æ–­çº¿ç¨‹åŒ–</li>
<li>è½¯ä¸­æ–­çº¿ç¨‹åŒ–</li>
</ul>
<p>è¿™æ ·ï¼Œç³»ç»Ÿå°±å‡ ä¹å˜å¾—éšå¤„å¯ä»¥æŠ¢å ï¼Œå˜ä¸ºä¸€ä¸ªå®æ—¶çš„æ“ä½œç³»ç»Ÿ</p>
<p>https://zhuanlan.zhihu.com/p/33461281</p>
<h1 id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</h1>
<h2 id="åœ°å€">åœ°å€</h2>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[linuxå†…æ ¸åè®®æ ˆä¹‹ç½‘ç»œä¿¡æ¯ç»Ÿè®¡SNMP]]></title>
        <id>https://weenews.github.io/post/linux-nei-he-xie-yi-zhan-zhi-wang-luo-xin-xi-tong-ji-snmp/</id>
        <link href="https://weenews.github.io/post/linux-nei-he-xie-yi-zhan-zhi-wang-luo-xin-xi-tong-ji-snmp/">
        </link>
        <updated>2020-05-11T10:53:58.000Z</updated>
        <content type="html"><![CDATA[<p><ul class="markdownIt-TOC">
<li><a href="#snmp%E7%AE%80%E4%BB%8B">SNMPç®€ä»‹</a></li>
<li><a href="#snmp%E4%BF%A1%E6%81%AF%E7%BB%9F%E8%AE%A1%E6%A1%86%E6%9E%B6%E5%92%8C%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90">SNMPä¿¡æ¯ç»Ÿè®¡æ¡†æ¶å’Œå®ç°åˆ†æ</a>
<ul>
<li><a href="#%E6%A1%86%E6%9E%B6">æ¡†æ¶</a></li>
<li><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">å…·ä½“å®ç°</a></li>
</ul>
</li>
</ul>
</p>
<h1 id="snmpç®€ä»‹">SNMPç®€ä»‹</h1>
<p>SNMPæ˜¯è‹±æ–‡&quot;Simple Network Management Protocol&quot;çš„ç¼©å†™ï¼Œä¸­æ–‡æ„æ€æ˜¯&quot;ç®€å•ç½‘ç»œç®¡ç†åè®®&quot;ã€‚SNMPæ˜¯ä¸€ç§ç®€å•ç½‘ç»œç®¡ç†åè®®ï¼Œå®ƒå±äºTCP/IPäº”å±‚åè®®ä¸­çš„åº”ç”¨å±‚åè®®ï¼Œç”¨äºç½‘ç»œç®¡ç†çš„åè®®ã€‚SNMPä¸»è¦ç”¨äºç½‘ç»œè®¾å¤‡çš„ç®¡ç†ã€‚ç”±äºSNMPåè®®ç®€å•å¯é  ï¼Œå—åˆ°äº†ä¼—å¤šå‚å•†çš„æ¬¢è¿ï¼Œæˆä¸ºäº†ç›®å‰æœ€ä¸ºå¹¿æ³›çš„ç½‘ç®¡åè®®ã€‚<br>
<strong>SNMPçš„å·¥ä½œæ–¹å¼</strong>ï¼šç®¡ç†å‘˜éœ€è¦å‘è®¾å¤‡è·å–æ•°æ®ï¼Œæ‰€ä»¥SNMPæä¾›äº†ã€è¯»ã€‘æ“ä½œï¼›ç®¡ç†å‘˜éœ€è¦å‘è®¾å¤‡æ‰§è¡Œè®¾ç½®æ“ä½œï¼Œæ‰€ä»¥SNMPæä¾›äº†ã€å†™ã€‘æ“ä½œï¼›è®¾å¤‡éœ€è¦åœ¨é‡è¦çŠ¶å†µæ”¹å˜çš„æ—¶å€™ï¼Œå‘ç®¡ç†å‘˜é€šæŠ¥äº‹ä»¶çš„å‘ç”Ÿï¼Œæ‰€ä»¥SNMPæä¾›äº†ã€Trapã€‘æ“ä½œã€‚</p>
<p>åœ¨å…·ä½“å®ç°ä¸Šï¼ŒSNMPä¸ºç®¡ç†å‘˜æä¾›äº†ä¸€ä¸ªç½‘ç®¡å¹³å°(NMS)ï¼Œåˆç§°ä¸ºã€ç®¡ç†ç«™ã€‘ï¼Œè´Ÿè´£ç½‘ç®¡å‘½ä»¤çš„å‘å‡ºã€æ•°æ®å­˜å‚¨ã€åŠæ•°æ®åˆ†æã€‚ã€è¢«ã€‘ç›‘ç®¡çš„è®¾å¤‡ä¸Šè¿è¡Œä¸€ä¸ªSNMPä»£ç†(Agent))ï¼Œä»£ç†å®ç°è®¾å¤‡ä¸ç®¡ç†ç«™çš„SNMPé€šä¿¡ã€‚<br>
<img src="https://img-blog.csdnimg.cn/20200421094847672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlbnFpYW5neGlu,size_16,color_FFFFFF,t_70" alt="SNMPçš„å®ç°ç»“æ„" loading="lazy"><br>
ç®¡ç†ç«™ä¸ä»£ç†ç«¯é€šè¿‡MIBè¿›è¡Œæ¥å£ç»Ÿä¸€ï¼ŒMIBå®šä¹‰äº†è®¾å¤‡ä¸­çš„è¢«ç®¡ç†å¯¹è±¡ã€‚ç®¡ç†ç«™å’Œä»£ç†éƒ½å®ç°äº†ç›¸åº”çš„MIBå¯¹è±¡ï¼Œä½¿å¾—åŒæ–¹å¯ä»¥è¯†åˆ«å¯¹æ–¹çš„æ•°æ®ï¼Œå®ç°é€šä¿¡ã€‚ç®¡ç†ç«™å‘ä»£ç†ç”³è¯·MIBä¸­å®šä¹‰çš„æ•°æ®ï¼Œä»£ç†è¯†åˆ«åï¼Œå°†ç®¡ç†è®¾å¤‡æä¾›çš„ç›¸å…³çŠ¶æ€æˆ–å‚æ•°ç­‰æ•°æ®ï¼ˆ<font color=red><strong>è¿™äº›æ•°æ®ç”±å†…æ ¸çš„ç›¸å…³å®ç°æä¾›ï¼Œå­˜å‚¨äº/procç­‰ä½ç½®ï¼Œä¸‹å›¾æ˜¯/proc/net/snmpæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè®°å½•äº†ipv4ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯</strong></font>ï¼‰è½¬æ¢ä¸ºMIBå®šä¹‰çš„æ ¼å¼ï¼Œåº”ç­”ç»™ç®¡ç†ç«™ï¼Œå®Œæˆä¸€æ¬¡ç®¡ç†æ“ä½œã€‚<br>
<img src="https://img-blog.csdnimg.cn/20200421095714443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlbnFpYW5neGlu,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>
<strong>å†…æ ¸ç½‘ç»œåè®®</strong>å¯¹SNMPåè®®çš„æ”¯æŒä¸»è¦ä½“ç°åœ¨ç»Ÿè®¡äº†ç›¸å…³çš„ç½‘ç»œä¿¡æ¯ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯é€šè¿‡procç³»ç»Ÿæˆ–å…¶ä»–é…ç½®æ–‡ä»¶è¿›è¡Œå±•ç¤ºï¼ˆæœ¬äººé¡¹ç›®åªæ˜¯ç®€å•æ¶‰åŠåˆ°è¿™ä¸ªåè®®ï¼Œè¿™æ˜¯æˆ‘å¯¹å®ƒçš„ä¸€ä¸ªç®€å•ç†è§£ï¼Œå¦‚æœæœ‰è¯¯æ¬¢è¿æŒ‡æ­£ã€äº¤æµï¼‰ã€‚ä¸‹é¢çš„å†…å®¹å°±æ˜¯ä»‹ç»å†…æ ¸ç½‘ç»œæ ˆæ˜¯å¦‚ä½•æä¾›è¿™äº›ç»Ÿè®¡ä¿¡æ¯çš„ï¼Œå®ƒçš„å®ç°æ¡†æ¶æ˜¯æ€æ ·çš„ã€‚</p>
<h1 id="snmpä¿¡æ¯ç»Ÿè®¡æ¡†æ¶å’Œå®ç°åˆ†æ">SNMPä¿¡æ¯ç»Ÿè®¡æ¡†æ¶å’Œå®ç°åˆ†æ</h1>
<h2 id="æ¡†æ¶">æ¡†æ¶</h2>
<figure data-type="image" tabindex="1"><img src="https://img-blog.csdnimg.cn/20200422093723284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlbnFpYW5neGlu,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></figure>
<h2 id="å…·ä½“å®ç°">å…·ä½“å®ç°</h2>
<p><strong>ç›¸å…³ç»“æ„ä½“å’Œå‡½æ•°çš„ä»£ç å±•ç¤ºåœ¨ä¸‹æ–¹çš„ä»£ç å—ä¸­ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚</strong><br>
1ã€é¦–å…ˆåœ¨netç»“æ„ä¸­å®šä¹‰äº†ä¸€ä¸ªnetns_mibç±»å‹çš„mibæˆå‘˜ï¼Œè¯¥æˆå‘˜ä¸­é€šè¿‡å®çš„æ–¹å¼å®šä¹‰äº†å­˜æ”¾å„åè®®ç»Ÿè®¡ä¿¡æ¯çš„æˆå‘˜ï¼ˆ<em><strong>æ˜¯æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥éœ€è¦åˆå§‹åŒ–åˆ†é…å†…å­˜</strong></em>ï¼‰ï¼Œå®ƒä»¬çš„ç±»å‹è¢«å®šä¹‰åœ¨&lt;include/net/snmp.h&gt;ä¸­ï¼Œå¤§å¤šæ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­å­˜æ”¾å„ä¸ªç»Ÿè®¡ä¿¡æ¯ï¼Œè‡³äºæ•°ç»„ä¸­ä»€ä¹ˆä½ç½®å­˜æ”¾ä»€ä¹ˆä¿¡æ¯åˆ™ç”±å®šä¹‰åœ¨&lt;include/uapi/linux/snmp.h&gt;ä¸­çš„æšä¸¾ç±»å‹å®šä¹‰ï¼Œè¿™äº›æšä¸¾ç±»å‹éƒ½ä»¥0å¼€å§‹ï¼Œè¡¨ç¤ºæ•°ç»„çš„ä¸‹æ ‡(è§ä¸‹æ–¹ä»£ç å—)ã€‚</p>
<pre><code class="language-c">struct net {
	atomic_t		passive;	/* To decided when the network
						 * namespace should be freed.
						 */
	atomic_t		count;		/* To decided when the network
						 *  namespace should be shut down.
						 */
	spinlock_t		rules_mod_lock;

	u32			hash_mix;
	atomic64_t		cookie_gen;

	struct list_head	list;		/* list of network namespaces */
	struct list_head	cleanup_list;	/* namespaces on death row */
	struct list_head	exit_list;	/* Use only net_mutex */

	struct user_namespace   *user_ns;	/* Owning user namespace */
	spinlock_t		nsid_lock;
	struct idr		netns_ids;

	struct ns_common	ns;

	struct proc_dir_entry 	*proc_net;
	struct proc_dir_entry 	*proc_net_stat;

#ifdef CONFIG_SYSCTL
	struct ctl_table_set	sysctls;
#endif

	struct sock 		*rtnl;			/* rtnetlink socket */
	struct sock		*genl_sock;

	struct list_head 	dev_base_head;
	struct hlist_head 	*dev_name_head;
	struct hlist_head	*dev_index_head;
	unsigned int		dev_base_seq;	/* protected by rtnl_mutex */
	int			ifindex;
	unsigned int		dev_unreg_count;

	/* core fib_rules */
	struct list_head	rules_ops;


	struct net_device       *loopback_dev;          /* The loopback */
	struct netns_core	core;
	struct netns_mib	mib;    /* here*/
	struct netns_packet	packet;
	struct netns_unix	unx;
	struct netns_ipv4	ipv4;
#if IS_ENABLED(CONFIG_IPV6)
	struct netns_ipv6	ipv6;
#endif
......åé¢çš„ä»£ç çœç•¥
</code></pre>
<pre><code class="language-c">struct netns_mib {
	DEFINE_SNMP_STAT(struct tcp_mib, tcp_statistics);
	DEFINE_SNMP_STAT(struct ipstats_mib, ip_statistics);
	DEFINE_SNMP_STAT(struct linux_mib, net_statistics);
	DEFINE_SNMP_STAT(struct udp_mib, udp_statistics);
	DEFINE_SNMP_STAT(struct udp_mib, udplite_statistics);
	DEFINE_SNMP_STAT(struct icmp_mib, icmp_statistics);
	DEFINE_SNMP_STAT_ATOMIC(struct icmpmsg_mib, icmpmsg_statistics);

#if IS_ENABLED(CONFIG_IPV6)
	struct proc_dir_entry *proc_net_devsnmp6;
	DEFINE_SNMP_STAT(struct udp_mib, udp_stats_in6);
	DEFINE_SNMP_STAT(struct udp_mib, udplite_stats_in6);
	DEFINE_SNMP_STAT(struct ipstats_mib, ipv6_statistics);
	DEFINE_SNMP_STAT(struct icmpv6_mib, icmpv6_statistics);
	DEFINE_SNMP_STAT_ATOMIC(struct icmpv6msg_mib, icmpv6msg_statistics);
#endif
#ifdef CONFIG_XFRM_STATISTICS
	DEFINE_SNMP_STAT(struct linux_xfrm_mib, xfrm_statistics);
#endif
};
</code></pre>
<pre><code class="language-c">struct ipstats_mib {
	/* mibs[] must be first field of struct ipstats_mib */
	u64		mibs[IPSTATS_MIB_MAX];
	struct u64_stats_sync syncp;
};

/* ICMP */
#define ICMP_MIB_MAX	__ICMP_MIB_MAX
struct icmp_mib {
	unsigned long	mibs[ICMP_MIB_MAX];
};
</code></pre>
<pre><code class="language-c">       ......
enum
{
	TCP_MIB_NUM = 0,
	TCP_MIB_RTOALGORITHM,			/* RtoAlgorithm */
	TCP_MIB_RTOMIN,				/* RtoMin */
	TCP_MIB_RTOMAX,				/* RtoMax */
	TCP_MIB_MAXCONN,			/* MaxConn */
	TCP_MIB_ACTIVEOPENS,			/* ActiveOpens */
	TCP_MIB_PASSIVEOPENS,			/* PassiveOpens */
	TCP_MIB_ATTEMPTFAILS,			/* AttemptFails */
	TCP_MIB_ESTABRESETS,			/* EstabResets */
	TCP_MIB_CURRESTAB,			/* CurrEstab */
	TCP_MIB_INSEGS,				/* InSegs */
	TCP_MIB_OUTSEGS,			/* OutSegs */
	TCP_MIB_RETRANSSEGS,			/* RetransSegs */
	TCP_MIB_INERRS,				/* InErrs */
	TCP_MIB_OUTRSTS,			/* OutRsts */
	TCP_MIB_CSUMERRORS,			/* InCsumErrors */
	__TCP_MIB_MAX
};

/* udp mib definitions */
/*
 * RFC 1213:  MIB-II UDP group
 * RFC 2013 (updates 1213):  SNMPv2-MIB-UDP
 */
enum
{
	UDP_MIB_NUM = 0,
	UDP_MIB_INDATAGRAMS,			/* InDatagrams */
	UDP_MIB_NOPORTS,			/* NoPorts */
	UDP_MIB_INERRORS,			/* InErrors */
	UDP_MIB_OUTDATAGRAMS,			/* OutDatagrams */
	UDP_MIB_RCVBUFERRORS,			/* RcvbufErrors */
	UDP_MIB_SNDBUFERRORS,			/* SndbufErrors */
	UDP_MIB_CSUMERRORS,			/* InCsumErrors */
	UDP_MIB_IGNOREDMULTI,			/* IgnoredMulti */
	__UDP_MIB_MAX
};
            ......
</code></pre>
<p>2ã€åè®®æ—åœ¨åˆå§‹åŒ–æ—¶ä¸ºè¿™äº›ç»Ÿè®¡ç»“æ„åˆ†é…ç©ºé—´ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œåˆå§‹åŒ–ç”¨çš„æ˜¯per_cpuå˜é‡ï¼Œå³åœ¨æ¯ä¸ªcpuä¸­éƒ½åˆ†é…ä¸€ä¸ªè¯¥å˜é‡çš„å‰¯æœ¬ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘åŒæ­¥æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ˆåœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸‹é¿å…äº†åœ¨ä¿®æ”¹æ­¤å€¼æ—¶çš„åŠ é”æ“ä½œï¼Œé€šè¿‡ç©ºé—´æ¢æ—¶é—´ï¼‰ã€‚<a href="http://www.wowotech.net/linux_kenrel/per-cpu.html">per_cpuç›¸å…³</a>ã€‚</p>
<pre><code class="language-c">static __net_init int ipv4_mib_init_net(struct net *net)
{
	int i;

	net-&gt;mib.tcp_statistics = alloc_percpu(struct tcp_mib);
	if (!net-&gt;mib.tcp_statistics)
		goto err_tcp_mib;
	net-&gt;mib.ip_statistics = alloc_percpu(struct ipstats_mib);
	if (!net-&gt;mib.ip_statistics)
		goto err_ip_mib;

	for_each_possible_cpu(i) {
		struct ipstats_mib *af_inet_stats;
		af_inet_stats = per_cpu_ptr(net-&gt;mib.ip_statistics, i);
		u64_stats_init(&amp;af_inet_stats-&gt;syncp);
	}

	net-&gt;mib.net_statistics = alloc_percpu(struct linux_mib);
	if (!net-&gt;mib.net_statistics)
		goto err_net_mib;
	net-&gt;mib.udp_statistics = alloc_percpu(struct udp_mib);
	if (!net-&gt;mib.udp_statistics)
		goto err_udp_mib;
	net-&gt;mib.udplite_statistics = alloc_percpu(struct udp_mib);
	if (!net-&gt;mib.udplite_statistics)
		goto err_udplite_mib;
	net-&gt;mib.icmp_statistics = alloc_percpu(struct icmp_mib);
	if (!net-&gt;mib.icmp_statistics)
		goto err_icmp_mib;
	net-&gt;mib.icmpmsg_statistics = kzalloc(sizeof(struct icmpmsg_mib),
					      GFP_KERNEL);
	if (!net-&gt;mib.icmpmsg_statistics)
		goto err_icmpmsg_mib;

	tcp_mib_init(net);
	return 0;

err_icmpmsg_mib:
	free_percpu(net-&gt;mib.icmp_statistics);
err_icmp_mib:
	free_percpu(net-&gt;mib.udplite_statistics);
err_udplite_mib:
	free_percpu(net-&gt;mib.udp_statistics);
err_udp_mib:
	free_percpu(net-&gt;mib.net_statistics);
err_net_mib:
	free_percpu(net-&gt;mib.ip_statistics);
err_ip_mib:
	free_percpu(net-&gt;mib.tcp_statistics);
err_tcp_mib:
	return -ENOMEM;
}

static __net_exit void ipv4_mib_exit_net(struct net *net)
{
	kfree(net-&gt;mib.icmpmsg_statistics);
	free_percpu(net-&gt;mib.icmp_statistics);
	free_percpu(net-&gt;mib.udplite_statistics);
	free_percpu(net-&gt;mib.udp_statistics);
	free_percpu(net-&gt;mib.net_statistics);
	free_percpu(net-&gt;mib.ip_statistics);
	free_percpu(net-&gt;mib.tcp_statistics);
}

static __net_initdata struct pernet_operations ipv4_mib_ops = {
	.init = ipv4_mib_init_net,
	.exit = ipv4_mib_exit_net,
};

static int __init init_ipv4_mibs(void)
{
	return register_pernet_subsys(&amp;ipv4_mib_ops);
}
</code></pre>
<p>3ã€å…§é•¶åœ¨ç½‘ç»œæ ˆä¸­çš„ç»Ÿè®¡å‡½æ•°åœ¨å¯¹åº”çš„ä½ç½®è¿›è¡Œç»Ÿè®¡ï¼Œå°†ä¿¡æ¯å†™å…¥ä¸Šè¿°çš„ç»Ÿè®¡å­—æ®µï¼ˆç»Ÿè®¡åˆ°å½“å‰cpuçš„å‰¯æœ¬ä¸­ï¼‰ã€‚æ¯”å¦‚ä¸‹æ–¹udp_recvmsgå‡½æ•°ä¸­çš„<strong>UDP_INC_STATS_USER(sock_net(sk), UDP_MIB_CSUMERRORS, is_udplite)</strong> å’Œ<br>
<strong>UDP_INC_STATS_USER(sock_net(sk), UDP_MIB_INERRORS, is_udplite)</strong> å°±æ˜¯åœ¨ç»Ÿè®¡æ ¡éªŒå’Œé”™è¯¯çš„æ•°æ®åŒ…ä»¥åŠæ¥æ”¶å‡ºé”™çš„æ•°æ®åŒ…<br>
è¿™äº›å®å…¶å®å°±æ˜¯å¢åŠ å¯¹åº”ç»Ÿè®¡å­—æ®µçš„å€¼ã€‚</p>
<pre><code class="language-c">int udp_recvmsg(struct sock *sk, struct msghdr *msg, size_t len, int noblock,
		int flags, int *addr_len)
{
	struct inet_sock *inet = inet_sk(sk);
	DECLARE_SOCKADDR(struct sockaddr_in *, sin, msg-&gt;msg_name);
	struct sk_buff *skb;
	unsigned int ulen, copied;
	int peeked, off = 0;
	int err;
	int is_udplite = IS_UDPLITE(sk);
	bool checksum_valid = false;
	bool slow;

	if (flags &amp; MSG_ERRQUEUE)
		return ip_recv_error(sk, msg, len, addr_len);

try_again:
	skb = __skb_recv_datagram(sk, flags | (noblock ? MSG_DONTWAIT : 0),
				  &amp;peeked, &amp;off, &amp;err);
	if (!skb)
		goto out;

	ulen = skb-&gt;len - sizeof(struct udphdr);
	copied = len;
	if (copied &gt; ulen)
		copied = ulen;
	else if (copied &lt; ulen)
		msg-&gt;msg_flags |= MSG_TRUNC;

	/*
	 * If checksum is needed at all, try to do it while copying the
	 * data.  If the data is truncated, or if we only want a partial
	 * coverage checksum (UDP-Lite), do it before the copy.
	 */

	if (copied &lt; ulen || UDP_SKB_CB(skb)-&gt;partial_cov) {
		checksum_valid = !udp_lib_checksum_complete(skb);
		if (!checksum_valid)
			goto csum_copy_err;
	}

	if (checksum_valid || skb_csum_unnecessary(skb))
		err = skb_copy_datagram_msg(skb, sizeof(struct udphdr),
					    msg, copied);
	else {
		err = skb_copy_and_csum_datagram_msg(skb, sizeof(struct udphdr),
						     msg);

		if (err == -EINVAL)
			goto csum_copy_err;
	}

	if (unlikely(err)) {
		trace_kfree_skb(skb, udp_recvmsg);
		if (!peeked) {
			atomic_inc(&amp;sk-&gt;sk_drops);
			UDP_INC_STATS_USER(sock_net(sk),
					   UDP_MIB_INERRORS, is_udplite);
		}
		goto out_free;
	}

	if (!peeked)
		UDP_INC_STATS_USER(sock_net(sk),
				UDP_MIB_INDATAGRAMS, is_udplite);

	sock_recv_ts_and_drops(msg, sk, skb);

	/* Copy the address. */
	if (sin) {
		sin-&gt;sin_family = AF_INET;
		sin-&gt;sin_port = udp_hdr(skb)-&gt;source;
		sin-&gt;sin_addr.s_addr = ip_hdr(skb)-&gt;saddr;
		memset(sin-&gt;sin_zero, 0, sizeof(sin-&gt;sin_zero));
		*addr_len = sizeof(*sin);
	}
	if (inet-&gt;cmsg_flags)
		ip_cmsg_recv_offset(msg, skb, sizeof(struct udphdr), off);

	err = copied;
	if (flags &amp; MSG_TRUNC)
		err = ulen;

out_free:
	skb_free_datagram_locked(sk, skb);
out:
	return err;

csum_copy_err:
	slow = lock_sock_fast(sk);
	if (!skb_kill_datagram(sk, skb, flags)) {
		UDP_INC_STATS_USER(sock_net(sk), UDP_MIB_CSUMERRORS, is_udplite);
		UDP_INC_STATS_USER(sock_net(sk), UDP_MIB_INERRORS, is_udplite);
	}
	unlock_sock_fast(sk, slow);

	/* starting over for a new packet, but check if we need to yield */
	cond_resched();
	msg-&gt;msg_flags &amp;= ~MSG_TRUNC;
	goto try_again;
}
</code></pre>
<p>4ã€å°†è¿™äº›æ•°æ®é€šè¿‡procç³»ç»Ÿï¼ˆè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œå­˜åœ¨äºå†…å­˜ä¸­ï¼‰å‘ç”¨æˆ·æä¾›è®¿é—®ã€‚è¿™æ—¶éœ€è¦å°†å¯¹åº”å­—æ®µåœ¨æ‰€æœ‰cpuä¸­çš„å‰¯æœ¬åŠ èµ·æ¥ï¼Œè¿™ä¸ªå·¥ä½œåœ¨ipv4ä¸­æ˜¯é€šè¿‡ä»¥ä¸‹å‡½æ•°å®Œæˆçš„ã€‚</p>
<pre><code class="language-c">unsigned long snmp_fold_field(void __percpu *mib, int offt)
{
	unsigned long res = 0;
	int i;

	for_each_possible_cpu(i)
		res += snmp_get_cpu_field(mib, i, offt);
	return res;
}
</code></pre>
<p>æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯éƒ½è¢«é€šè¿‡/proc/net/snmpæ–‡ä»¶å±•ç¤ºç»™ç”¨æˆ·ã€‚<br>
è¿™éƒ¨åˆ†çš„å®ç°åœ¨å¯¹åº”åè®®æ—ä¸‹çš„proc.cæ–‡ä»¶ä¸­ï¼Œå°†ä¸Šè¿°ç»Ÿè®¡ä¿¡æ¯æŒ‰ç…§ç‰¹å®šæ ¼å¼å±•ç¤ºåœ¨procæ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="language-c">static int snmp_seq_show(struct seq_file *seq, void *v)
{
	int i;
	struct net *net = seq-&gt;private;

	seq_puts(seq, &quot;Ip: Forwarding DefaultTTL&quot;);

	for (i = 0; snmp4_ipstats_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %s&quot;, snmp4_ipstats_list[i].name);

	seq_printf(seq, &quot;\nIp: %d %d&quot;,
		   IPV4_DEVCONF_ALL(net, FORWARDING) ? 1 : 2,
		   sysctl_ip_default_ttl);

	BUILD_BUG_ON(offsetof(struct ipstats_mib, mibs) != 0);
	for (i = 0; snmp4_ipstats_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %llu&quot;,
			   snmp_fold_field64(net-&gt;mib.ip_statistics,
					     snmp4_ipstats_list[i].entry,
					     offsetof(struct ipstats_mib, syncp)));

	icmp_put(seq);	/* RFC 2011 compatibility */
	icmpmsg_put(seq);

	seq_puts(seq, &quot;\nTcp:&quot;);
	for (i = 0; snmp4_tcp_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %s&quot;, snmp4_tcp_list[i].name);

	seq_puts(seq, &quot;\nTcp:&quot;);
	for (i = 0; snmp4_tcp_list[i].name != NULL; i++) {
		/* MaxConn field is signed, RFC 2012 */
		if (snmp4_tcp_list[i].entry == TCP_MIB_MAXCONN)
			seq_printf(seq, &quot; %ld&quot;,
				   snmp_fold_field(net-&gt;mib.tcp_statistics,
						   snmp4_tcp_list[i].entry));
		else
			seq_printf(seq, &quot; %lu&quot;,
				   snmp_fold_field(net-&gt;mib.tcp_statistics,
						   snmp4_tcp_list[i].entry));
	}

	seq_puts(seq, &quot;\nUdp:&quot;);
	for (i = 0; snmp4_udp_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %s&quot;, snmp4_udp_list[i].name);

	seq_puts(seq, &quot;\nUdp:&quot;);
	for (i = 0; snmp4_udp_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %lu&quot;,
			   snmp_fold_field(net-&gt;mib.udp_statistics,
					   snmp4_udp_list[i].entry));

	/* the UDP and UDP-Lite MIBs are the same */
	seq_puts(seq, &quot;\nUdpLite:&quot;);
	for (i = 0; snmp4_udp_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %s&quot;, snmp4_udp_list[i].name);

	seq_puts(seq, &quot;\nUdpLite:&quot;);
	for (i = 0; snmp4_udp_list[i].name != NULL; i++)
		seq_printf(seq, &quot; %lu&quot;,
			   snmp_fold_field(net-&gt;mib.udplite_statistics,
					   snmp4_udp_list[i].entry));

	seq_putc(seq, '\n');
	return 0;
}

static __net_init int ip_proc_init_net(struct net *net)
{
	if (!proc_create(&quot;sockstat&quot;, S_IRUGO, net-&gt;proc_net,
			 &amp;sockstat_seq_fops))
		goto out_sockstat;
	if (!proc_create(&quot;netstat&quot;, S_IRUGO, net-&gt;proc_net, &amp;netstat_seq_fops))
		goto out_netstat;
	if (!proc_create(&quot;snmp&quot;, S_IRUGO, net-&gt;proc_net, &amp;snmp_seq_fops))
		goto out_snmp;

	return 0;

out_snmp:
	remove_proc_entry(&quot;netstat&quot;, net-&gt;proc_net);
out_netstat:
	remove_proc_entry(&quot;sockstat&quot;, net-&gt;proc_net);
out_sockstat:
	return -ENOMEM;
}
</code></pre>
<p>æœ¬æ–‡åªæ˜¯ç®€å•å¯¹å†…æ ¸ç½‘ç»œæ ˆå¯¹snmpçš„æ”¯æŒè¿›è¡Œäº†åˆ†æï¼Œæ€»çš„æ¥è¯´ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¿˜æ˜¯æ¯”è¾ƒç‹¬ç«‹çš„ï¼Œåœ¨å¼€å‘è‡ªå·±çš„åè®®æ ˆæ—¶ï¼Œå¦‚æœè¦å¢åŠ è¿™éƒ¨åˆ†å†…å®¹ï¼Œé‚£ä¹ˆä½ æ‰€éœ€è¦åšçš„å¹¶ä¸å¤æ‚ï¼Œå”¯ä¸€æ¯”è¾ƒéº»çƒ¦çš„åœ°æ–¹å¯èƒ½å°±åœ¨äºåœ¨å¢åŠ äº†è‡ªå·±å®šä¹‰çš„å†…å®¹åéœ€è¦é‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œå› ä¸ºä½ æ”¹åŠ¨äº†netç»“æ„ä½“ï¼è¿™ä¸ªç»“æ„ä½“æ˜¯æ‰€æœ‰å†…æ ¸ç½‘ç»œåè®®æ ˆå…±ç”¨çš„ï¼<br>
OVER</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello]]></title>
        <id>https://weenews.github.io/post/hello/</id>
        <link href="https://weenews.github.io/post/hello/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>